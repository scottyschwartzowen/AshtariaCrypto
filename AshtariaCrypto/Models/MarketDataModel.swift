//
//  MarketDataModel.swift
//  AshtariaCrypto
//
//  Created by Scotty Schwartz-Owen on 9/19/24.
//

import Foundation

// JSON data:
 /*

	URL: "https://api.coingecko.com/api/v3/global"

	JSON Response:
	{"data":{"active_cryptocurrencies":14691,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1197,"total_market_cap":{"btc":36072409.053286545,"eth":921268666.0828899,"ltc":34692385557.326836,"bch":6671884532.738191,"bnb":4019797412.676689,"eos":4471762700871.94,"xrp":3857730132726.559,"xlm":23701606678343.156,"link":202186542169.90533,"dot":532922723500.0019,"yfi":452584237.3201799,"usd":2270727440473.5493,"aed":8340381888859.351,"ars":2186305370632463.5,"aud":3332521862366.4214,"bdt":271754808411260.4,"bhd":855834901587.0399,"bmd":2270727440473.5493,"brl":12314381982432.115,"cad":3078697678342.8496,"chf":1924639059088.6553,"clp":2113093707318979.8,"cny":16049501549267.053,"czk":51056398208071.54,"dkk":15174817339196.635,"eur":2034292487189.1223,"gbp":1709498987740.9868,"gel":6091226359070.302,"hkd":17697636398656.664,"huf":801952810152043.5,"idr":3.4520000500626052e+16,"ils":8570849370430.222,"inr":190119729518602.28,"jpy":323860230470099.44,"krw":3011813619573533.5,"kwd":692219906591.1576,"lkr":692095041559935.5,"mmk":4.763986170113496e+15,"mxn":43867876874303.945,"myr":9559762524393.65,"ngn":3.727248149201436e+15,"nok":23820612068799.668,"nzd":3639640019417.896,"php":126169568680206.92,"pkr":632078661690685.1,"pln":8695410124177.379,"rub":209263471875542.28,"sar":8521115898028.967,"sek":23080320862293.684,"sgd":2934515568782.5415,"thb":75229200102888.62,"try":77397744808541.02,"twd":72447561259036.16,"uah":94236124319357.73,"vef":227367938614.61664,"vnd":5.581241975854394e+16,"zar":39780692371460.84,"xdr":1685413381779.8867,"xag":73743349602.21492,"xau":877817813.9382654,"bits":36072409053286.55,"sats":3607240905328654.5},"total_volume":{"btc":1906140.5542215526,"eth":48681737.97763573,"ltc":1833217264.0819457,"bch":352556150.66211075,"bnb":212414392.8601796,"eos":236297171624.8795,"xrp":203850423252.0235,"xlm":1252441821200.796,"link":10683954237.117117,"dot":28160736756.698574,"yfi":23915485.314081818,"usd":119989925138.53151,"aed":440722995033.8264,"ars":115528888706013.11,"aud":176097334123.23398,"bdt":14360085026542.375,"bhd":45224082794.78737,"bmd":119989925138.53151,"brl":650717363018.7708,"cad":162684740301.32388,"chf":101701900678.39256,"clp":111660233294679.25,"cny":848088790879.1411,"czk":2697925470769.824,"dkk":801868671715.7783,"eur":107496214163.33221,"gbp":90333455221.14227,"gel":321872974184.1111,"hkd":935179638363.3386,"huf":42376841861175.18,"idr":1824108081852564.8,"ils":452901372485.7621,"inr":10046318948582.188,"jpy":17113443082957.916,"krw":159150448575401.16,"kwd":36578328728.85555,"lkr":36571730602862.22,"mmk":251738862940638.53,"mxn":2318069165111.3916,"myr":505157584833.2181,"ngn":196955485904614.9,"nok":1258730311680.7366,"nzd":192326091488.1448,"php":6667060445414.645,"pkr":33400341206125.46,"pln":459483419829.2353,"rub":11057913810800.229,"sar":450273353145.3778,"sek":1219611796236.6982,"sgd":155065860014.72772,"thb":3975266219839.546,"try":4089856598346.8506,"twd":3828278681534.78,"uah":4979631329098.213,"vef":12014591204.121168,"vnd":2.94924346676824e+15,"zar":2102093899307.921,"xdr":89060722085.19803,"xag":3896750812.325156,"xau":46385705.260053545,"bits":1906140554221.5525,"sats":190614055422155.25},"market_cap_percentage":{"btc":54.768415857160534,"eth":13.063239334663349,"usdt":5.235123121196915,"bnb":3.629681122382626,"sol":2.948898492368434,"usdc":1.5655459514421382,"xrp":1.4626561160049352,"steth":1.0587503043496327,"doge":0.6788804856728237,"ton":0.6350824883931303},"market_cap_change_percentage_24h_usd":3.2723187443850463,"updated_at":1726782425}}

	*/

struct GlobalData: Codable {
	let data: MarketDataModel?
}

struct MarketDataModel: Codable {
	let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
	let marketCapChangePercentage24HUsd: Double

	enum CodingKeys: String, CodingKey {
		case totalMarketCap = "total_market_cap"
		case totalVolume = "total_volume"
		case marketCapPercentage = "market_cap_percentage"
		case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
	}

	var marketCap: String {
		if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
			return "$" + item.value.formattedWithAbbreviations()
		}
		return ""
	}

	var volume: String {
		if let item = totalVolume.first(where: { $0.key == "usd" }) {
			return "$" + item.value.formattedWithAbbreviations()
		}
		return ""
	}

	var btcDominance: String {
		if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
			return item.value.asPercentString()		}
		return ""
	}
}
